package br.com.mooncompass;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.math.BigDecimal;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collections;
import java.util.List;
import java.util.stream.Collectors;
import java.util.stream.Stream;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.http.ResponseEntity;
import org.springframework.web.client.RestTemplate;

import br.com.mooncompass.usecases.IdentifyTrendUseCase;
import br.com.mooncompass.usecases.data.IdentifyTrendIn;
import yahoofinance.Stock;
import yahoofinance.YahooFinance;
import yahoofinance.histquotes.HistoricalQuote;
import yahoofinance.histquotes.Interval;

@SpringBootApplication
public class MoonCompassApplication {

	private static final String PAPER = "SUZB3.SA";

	public static void main(String[] args) throws IOException {
		SpringApplication.run(MoonCompassApplication.class, args);

		IdentifyTrendUseCase useCase = new IdentifyTrendUseCase();

//		List<Double> history = Arrays.asList(
//				83.72,85.00,84.50,
//				84.00,82.00,87.00,
//				86.50,86.00,87.00,
//				88.00,87.00,88.00,
//				87.00,87.50,86.00,
//				87.00,89.00,78.51,
//				77.37,78.63,80.40,
//				82.48,83.48,86.48,
//				84.83,83.72,
//				82.48,83.48,86.48,
//				84.83,83.72,82.71
//				);
//		
		// Collections.reverse(history);
		// VALE3
		// List<Double> history =
		// Arrays.asList(43.369998931884766,42.779998779296875,40.5,43.130001068115234,43.779998779296875,43.5099983215332,43.279998779296875,44.56999969482422,44.529998779296875,43.189998626708984,42.7599983215332,44.0,42.459999084472656,42.900001525878906,43.5099983215332,43.7599983215332,44.54999923706055,44.61000061035156,46.72999954223633,44.86000061035156,43.93000030517578,43.70000076293945,44.33000183105469,46.04999923706055,48.849998474121094,47.72999954223633,47.459999084472656,48.540000915527344,48.09000015258789,48.04999923706055,51.2599983215332,52.29999923706055,52.5,51.130001068115234,50.27000045776367,50.099998474121094,49.20000076293945,50.63999938964844,50.09000015258789,53.0,53.41999816894531,53.41999816894531,53.65999984741211,55.65999984741211,54.61000061035156,54.779998779296875,54.9900016784668,54.20000076293945,53.400001525878906,53.880001068115234,55.38999938964844,56.20000076293945,56.16999816894531,55.16999816894531,55.0,55.59000015258789,55.38999938964844,56.0,55.619998931884766,55.630001068115234,55.91999816894531,54.540000915527344,55.4900016784668,55.2599983215332,56.56999969482422,56.369998931884766,57.31999969482422,56.41999816894531,56.970001220703125,57.650001525878906,61.70000076293945,61.790000915527344,60.119998931884766,61.040000915527344,60.79999923706055,59.70000076293945,59.2400016784668,58.849998474121094,58.599998474121094,61.369998931884766,60.34000015258789,62.95000076293945,61.27000045776367,60.709999084472656,60.2599983215332,60.70000076293945,62.189998626708984,61.83000183105469,60.45000076293945,62.20000076293945,60.279998779296875,61.5,60.349998474121094,61.349998474121094,62.22999954223633,63.060001373291016,62.38999938964844,62.95000076293945,62.20000076293945,62.959999084472656,61.619998931884766,61.75,60.790000915527344,61.099998474121094,59.68000030517578,61.7599983215332,61.31999969482422,59.31999969482422,60.4900016784668,59.27000045776367,60.0,58.529998779296875,61.95000076293945,61.90999984741211,62.599998474121094,60.970001220703125,62.08000183105469,61.65999984741211,60.0,57.810001373291016,59.099998474121094,58.65999984741211,59.25,58.779998779296875,58.349998474121094,59.11000061035156,58.86000061035156,58.31999969482422,59.59000015258789,58.619998931884766,60.16999816894531,61.290000915527344,61.599998474121094,62.13999938964844,63.0,62.470001220703125,62.2400016784668,61.95000076293945,61.84000015258789,62.849998474121094,63.099998474121094,63.45000076293945,62.5,62.529998779296875,60.2599983215332,62.02000045776367,60.54999923706055,63.34000015258789,61.58000183105469,62.54999923706055,63.189998626708984,63.189998626708984,63.15999984741211,63.599998474121094,62.66999816894531,63.25,64.91999816894531,66.97000122070312,66.44999694824219,67.72000122070312,71.29000091552734,74.80000305175781,75.5,76.56999969482422,78.44000244140625,78.0,81.25,79.83999633789062,78.95999908447266,81.9800033569336,82.94999694824219,82.9000015258789,82.69999694824219,85.0,84.86000061035156,83.55000305175781,84.5,86.22000122070312,87.19999694824219,87.80000305175781,86.86000061035156,86.94000244140625,87.36000061035156,87.30999755859375,87.06999969482422,87.44999694824219,91.45999908447266,93.0,96.05000305175781,102.31999969482422,102.0,101.9800033569336,99.19000244140625,96.22000122070312,97.80000305175781,93.55000305175781,94.30999755859375,94.05999755859375,92.31999969482422,93.36000061035156,93.16999816894531,91.75,89.19999694824219,91.0999984741211,87.94999694824219,91.2699966430664,87.66000366210938,90.43000030517578,89.29000091552734,92.69000244140625,94.01000213623047,94.25,94.69999694824219,93.0999984741211,93.88999938964844,96.3499984741211,97.4000015258789,97.7699966430664,95.3499984741211,96.94999694824219,97.93000030517578,95.70999908447266,94.5199966430664,98.56999969482422,101.5999984741211,100.3499984741211,98.86000061035156,100.20999908447266,99.66999816894531,98.66999816894531,97.1500015258789,99.69999694824219,97.4000015258789,96.81999969482422,96.51000213623047,97.9000015258789,96.16000366210938,94.77999877929688,93.20999908447266,91.05999755859375,93.1500015258789,92.44000244140625,95.52999877929688,97.9800033569336,97.06999969482422,97.97000122070312,97.38999938964844,103.38999938964844,102.05000305175781,104.55999755859375,104.5,103.0,103.4000015258789,103.58000183105469,107.0,108.20999908447266,108.66999816894531,107.7300033569336,106.16000366210938,106.2300033569336,107.98999786376953,108.56999969482422,110.12000274658203,111.91999816894531,111.94999694824219,109.0199966430664,108.45999908447266,110.0999984741211,110.70999908447266,115.05000305175781,115.44999694824219,114.69000244140625,118.72000122070312,114.33000183105469,112.48999786376953,110.55999755859375,113.45999908447266,114.5999984741211,112.25,111.11000061035156,109.4000015258789,109.77999877929688,107.05000305175781,110.19999694824219,110.98999786376953,111.58999633789062,114.77999877929688,113.19999694824219,114.80000305175781,112.9000015258789,111.80000305175781,109.91999816894531,112.19999694824219,111.83000183105469,114.33999633789062,113.72000122070312,111.5,108.1500015258789,105.9000015258789,109.08999633789062,110.11000061035156,111.4000015258789,113.06999969482422,111.02999877929688,112.4000015258789,110.5999984741211,112.51000213623047,113.25,111.27999877929688,113.58000183105469,113.16999816894531,113.7699966430664,114.0999984741211,113.66000366210938,115.06999969482422,115.75,115.12000274658203,115.4800033569336,113.4000015258789,112.16000366210938,113.0999984741211,114.4000015258789,114.69999694824219,114.12000274658203,116.5999984741211,114.18000030517578,117.30000305175781,115.56999969482422,108.76000213623047,108.93000030517578,112.63999938964844,112.5199966430664,109.08000183105469,109.69999694824219,109.01000213623047,110.05999755859375,109.2699966430664,109.19999694824219,108.30000305175781,108.80000305175781,107.0,103.41000366210938,97.51000213623047,97.55000305175781,96.19999694824219,99.70999908447266,99.5,98.2300033569336,100.69000244140625,100.05000305175781,98.68000030517578,98.8499984741211,98.54000091552734,98.61000061035156,97.05999755859375,95.04000091552734,94.69999694824219,94.80999755859375,94.76000213623047,94.08999633789062,91.73999786376953,87.93000030517578,86.1500015258789,82.75,84.12000274658203,87.11000061035156,78.91000366210938,77.69000244140625,78.80000305175781,74.8499984741211,75.80000305175781,76.23999786376953,76.19999694824219,75.48999786376953,74.94999694824219,77.05999755859375,79.36000061035156,79.8499984741211,81.62000274658203,79.19999694824219,79.19999694824219,80.68000030517578,79.91999816894531,79.0,76.66999816894531,75.16000366210938,76.08000183105469,77.0,76.18000030517578,74.44999694824219,73.69999694824219,71.61000061035156,72.31999969482422,66.83000183105469,66.06999969482422,64.11000061035156,67.5999984741211,65.94000244140625,65.69000244140625,68.01000213623047,68.30000305175781,66.33000183105469,65.0,62.33000183105469,64.02999877929688,67.58999633789062,69.37000274658203,70.9800033569336,70.5,68.63999938964844,69.5,69.94999694824219,70.2300033569336,73.48999786376953,71.87000274658203,75.7699966430664,76.33000183105469,75.76000213623047,75.18000030517578,75.6500015258789,77.86000061035156,77.8499984741211,77.41000366210938,80.44000244140625,79.16999816894531,78.27999877929688,80.33999633789062,79.91999816894531,79.1500015258789,78.94999694824219,77.05000305175781,77.25,77.95999908447266,78.0,77.08000183105469,77.80999755859375,79.37999725341797,84.0,83.0,84.58000183105469,85.5,84.19999694824219,84.69000244140625,84.25,86.30999755859375,88.20999908447266,86.70999908447266,84.91000366210938,83.87000274658203,84.05999755859375,84.30000305175781,84.48999786376953,83.66000366210938,80.87000274658203,85.30999755859375,85.79000091552734,85.75,88.0,90.12999725341797,91.38999938964844,91.41000366210938,93.87000274658203,91.97000122070312,91.56999969482422,88.8499984741211,89.5,85.6500015258789,85.83000183105469,85.9000015258789,87.38999938964844,86.47000122070312,87.54000091552734,92.27999877929688,99.6500015258789,99.69999694824219,101.97000122070312,105.06999969482422,100.45999908447266,94.19000244140625,97.30000305175781,96.79000091552734,91.5999984741211,88.97000122070312,91.12999725341797,94.30000305175781,96.08999633789062,98.80999755859375,96.5999984741211,96.44999694824219,96.91000366210938,95.2300033569336,95.33999633789062,94.5199966430664,95.87000274658203,95.5999984741211,96.95999908447266,97.94000244140625,95.11000061035156,96.55000305175781,97.12999725341797,95.1500015258789,94.0,93.37000274658203,93.4000015258789,92.08999633789062,90.56999969482422,87.68000030517578,85.4000015258789,80.44999694824219,79.08000183105469,78.0,82.16999816894531,84.19999694824219,83.29000091552734,82.91999816894531,82.5,81.80999755859375,80.33000183105469,79.76000213623047,76.48999786376953,75.54000091552734,78.69000244140625,77.9000015258789,77.80999755859375,80.13999938964844,79.80000305175781,77.77999877929688,79.8499984741211,81.26000213623047,82.91999816894531,84.04000091552734,84.30000305175781,84.25,85.72000122070312,86.6500015258789,86.20999908447266,88.23999786376953,89.9000015258789,88.45999908447266,88.55000305175781,90.62000274658203,87.5,84.54000091552734,84.55999755859375,81.87999725341797,81.72000122070312,81.66999816894531,77.41000366210938,75.5,76.0,75.3499984741211,72.5999984741211,74.62000274658203,78.05000305175781,79.44999694824219,78.79000091552734,76.55999755859375,75.0999984741211,74.66999816894531,74.30000305175781,75.0,77.18000030517578,75.4000015258789,72.83000183105469,73.05000305175781,72.80000305175781,67.94999694824219,68.37000274658203,68.7300033569336,68.87999725341797,67.38999938964844,68.56999969482422,69.20999908447266,70.48999786376953,70.36000061035156,70.5199966430664,70.69000244140625,69.75,68.08000183105469,70.25,67.5199966430664,67.12999725341797,68.0,68.58000183105469,70.0,70.05000305175781,72.48999786376953,69.80000305175781,68.30000305175781,69.81999969482422,68.2300033569336,67.72000122070312,66.95999908447266,65.9800033569336,70.20999908447266,67.94999694824219,69.2699966430664,68.2300033569336,66.91000366210938,64.97000122070312,64.5,63.88999938964844,62.91999816894531,65.22000122070312,63.66999816894531,64.51000213623047,69.55000305175781,70.16000366210938,68.25,67.0,68.3499984741211,68.25,70.45999908447266,69.44999694824219,68.44999694824219,70.0199966430664,68.56999969482422,68.72000122070312,67.69999694824219,68.33999633789062,68.43000030517578,72.04000091552734,74.0,75.79000091552734,76.95999908447266,75.2300033569336,75.51000213623047,73.98999786376953,73.48999786376953,72.18000030517578,69.83000183105469,70.93000030517578,71.95999908447266,71.11000061035156,72.0199966430664,74.12999725341797,71.93000030517578,71.93000030517578,73.52999877929688,70.91000366210938,67.44999694824219,67.12999725341797,69.16999816894531,67.1500015258789,72.25,71.87000274658203,74.05000305175781,73.1500015258789,74.55000305175781,82.30000305175781,83.30999755859375,82.44000244140625,83.0999984741211,80.83000183105469,79.91999816894531,80.13999938964844,80.93000030517578,81.44999694824219,80.9000015258789);
		// PETR4
		// List<Double> history =
		// Arrays.asList(14.300000190734863,15.510000228881836,15.34000015258789,15.770000457763672,16.399999618530273,17.31999969482422,16.81999969482422,16.93000030517578,16.729999542236328,16.3799991607666,15.720000267028809,16.1299991607666,15.949999809265137,16.75,16.950000762939453,15.949999809265137,16.450000762939453,17.25,18.200000762939453,18.049999237060547,17.3799991607666,17.940000534057617,17.280000686645508,17.440000534057617,18.479999542236328,18.149999618530273,18.139999389648438,17.59000015258789,17.399999618530273,17.149999618530273,18.540000915527344,18.68000030517578,19.299999237060547,19.190000534057617,18.670000076293945,19.479999542236328,19.670000076293945,19.93000030517578,19.770000457763672,20.34000015258789,20.329999923706055,21.399999618530273,21.469999313354492,21.43000030517578,22.100000381469727,22.530000686645508,21.719999313354492,21.399999618530273,20.600000381469727,20.700000762939453,21.3700008392334,21.440000534057617,21.600000381469727,21.469999313354492,20.950000762939453,21.649999618530273,21.0,21.469999313354492,20.84000015258789,21.65999984741211,21.549999237060547,21.709999084472656,22.059999465942383,21.979999542236328,22.510000228881836,22.229999542236328,22.649999618530273,22.139999389648438,22.510000228881836,22.15999984741211,22.899999618530273,23.34000015258789,22.719999313354492,22.739999771118164,22.739999771118164,23.3700008392334,23.049999237060547,22.56999969482422,22.729999542236328,23.200000762939453,22.799999237060547,23.170000076293945,22.81999969482422,22.200000762939453,21.799999237060547,21.780000686645508,23.18000030517578,23.219999313354492,22.790000915527344,23.450000762939453,23.079999923706055,23.479999542236328,22.84000015258789,22.670000076293945,22.600000381469727,23.020000457763672,22.889999389648438,22.729999542236328,22.559999465942383,22.969999313354492,22.8700008392334,22.219999313354492,22.149999618530273,22.540000915527344,21.889999389648438,22.8700008392334,22.799999237060547,22.8799991607666,22.920000076293945,22.260000228881836,22.729999542236328,22.1200008392334,21.8799991607666,21.68000030517578,21.670000076293945,21.729999542236328,22.149999618530273,21.649999618530273,20.899999618530273,20.799999237060547,20.229999542236328,20.399999618530273,20.1299991607666,19.6299991607666,19.309999465942383,19.610000610351562,19.850000381469727,19.020000457763672,20.030000686645508,19.93000030517578,19.790000915527344,20.440000534057617,19.799999237060547,20.1299991607666,19.969999313354492,19.75,19.329999923706055,19.520000457763672,20.18000030517578,20.15999984741211,20.84000015258789,20.56999969482422,20.25,19.8799991607666,18.670000076293945,19.290000915527344,18.940000534057617,19.649999618530273,19.719999313354492,19.889999389648438,19.75,21.610000610351562,23.079999923706055,22.8799991607666,21.90999984741211,22.6299991607666,23.290000915527344,23.690000534057617,23.549999237060547,23.81999969482422,25.100000381469727,26.219999313354492,26.25,25.81999969482422,25.5,24.899999618530273,25.600000381469727,25.90999984741211,26.639999389648438,27.530000686645508,27.0,26.65999984741211,26.940000534057617,27.81999969482422,27.56999969482422,27.6200008392334,27.850000381469727,28.190000534057617,28.239999771118164,28.100000381469727,27.020000457763672,27.280000686645508,27.950000762939453,28.18000030517578,28.270000457763672,28.34000015258789,28.90999984741211,30.040000915527344,30.100000381469727,31.0,31.1200008392334,30.860000610351562,30.6299991607666,29.149999618530273,29.450000762939453,28.1200008392334,28.06999969482422,28.690000534057617,28.209999084472656,27.549999237060547,27.09000015258789,27.0,27.399999618530273,27.760000228881836,26.690000534057617,27.530000686645508,28.65999984741211,28.940000534057617,28.81999969482422,28.84000015258789,28.110000610351562,27.540000915527344,27.799999237060547,28.079999923706055,28.440000534057617,29.59000015258789,29.270000457763672,27.329999923706055,21.670000076293945,24.059999465942383,24.399999618530273,23.190000534057617,22.239999771118164,22.0,21.989999771118164,21.190000534057617,22.219999313354492,22.389999389648438,21.100000381469727,21.59000015258789,22.34000015258789,23.290000915527344,23.170000076293945,23.649999618530273,23.280000686645508,24.079999923706055,23.239999771118164,24.0,23.520000457763672,22.799999237060547,22.81999969482422,23.200000762939453,23.459999084472656,23.829999923706055,23.829999923706055,24.100000381469727,23.889999389648438,24.040000915527344,24.020000457763672,24.0,23.700000762939453,23.649999618530273,23.889999389648438,23.969999313354492,24.350000381469727,23.09000015258789,22.950000762939453,24.280000686645508,23.81999969482422,23.709999084472656,23.690000534057617,23.780000686645508,23.100000381469727,23.940000534057617,23.6200008392334,23.6200008392334,23.43000030517578,22.889999389648438,23.829999923706055,23.5,24.3799991607666,24.700000762939453,25.149999618530273,24.780000686645508,24.989999771118164,26.299999237060547,26.65999984741211,26.350000381469727,26.149999618530273,25.93000030517578,25.950000762939453,26.389999389648438,25.84000015258789,26.09000015258789,25.90999984741211,26.989999771118164,26.8700008392334,27.290000915527344,27.8700008392334,28.5,28.290000915527344,28.65999984741211,28.65999984741211,28.68000030517578,28.56999969482422,28.75,29.030000686645508,29.139999389648438,28.1299991607666,28.31999969482422,28.950000762939453,29.100000381469727,29.299999237060547,29.649999618530273,29.100000381469727,29.049999237060547,29.18000030517578,29.43000030517578,29.059999465942383,29.18000030517578,28.850000381469727,27.670000076293945,28.049999237060547,27.489999771118164,27.729999542236328,27.899999618530273,27.670000076293945,27.079999923706055,26.68000030517578,26.239999771118164,26.59000015258789,26.959999084472656,26.899999618530273,26.739999771118164,27.469999313354492,27.149999618530273,27.709999084472656,27.809999465942383,26.90999984741211,26.40999984741211,26.850000381469727,26.280000686645508,28.350000381469727,28.389999389648438,28.190000534057617,28.280000686645508,28.670000076293945,29.100000381469727,29.350000381469727,28.639999389648438,27.030000686645508,26.790000915527344,26.639999389648438,26.600000381469727,27.020000457763672,27.579999923706055,27.729999542236328,27.489999771118164,28.489999771118164,28.299999237060547,27.190000534057617,27.040000915527344,26.600000381469727,26.329999923706055,26.459999084472656,24.969999313354492,25.5,25.34000015258789,26.229999542236328,25.8799991607666,26.329999923706055,26.100000381469727,24.93000030517578,24.649999618530273,25.209999084472656,25.850000381469727,26.84000015258789,26.899999618530273,27.139999389648438,26.959999084472656,27.389999389648438,27.229999542236328,28.0,28.790000915527344,29.420000076293945,28.639999389648438,28.600000381469727,29.1200008392334,29.31999969482422,29.6299991607666,29.68000030517578,29.600000381469727,29.450000762939453,28.010000228881836,28.5,27.450000762939453,27.18000030517578,29.040000915527344,28.760000228881836,28.690000534057617,28.959999084472656,27.149999618530273,28.0,26.850000381469727,26.0,25.850000381469727,26.1200008392334,26.639999389648438,26.43000030517578,26.450000762939453,26.989999771118164,27.270000457763672,26.579999923706055,26.540000915527344,26.100000381469727,26.360000610351562,27.799999237060547,28.3700008392334,29.6200008392334,28.469999313354492,29.469999313354492,29.43000030517578,29.600000381469727,28.360000610351562,28.760000228881836,28.889999389648438,29.360000610351562,29.350000381469727,29.290000915527344,29.649999618530273,29.469999313354492,29.1200008392334,29.299999237060547,29.690000534057617,28.989999771118164,28.15999984741211,28.200000762939453,28.15999984741211,28.329999923706055,28.75,28.780000686645508,28.540000915527344,28.450000762939453,29.09000015258789,29.200000762939453,28.06999969482422,28.049999237060547,28.18000030517578,28.010000228881836,28.84000015258789,29.719999313354492,30.31999969482422,31.450000762939453,31.5,31.639999389648438,31.489999771118164,31.719999313354492,31.770000457763672,31.950000762939453,32.9900016784668,33.869998931884766,33.880001068115234,32.540000915527344,32.349998474121094,33.0,32.52000045776367,32.06999969482422,32.630001068115234,32.150001525878906,31.829999923706055,31.950000762939453,32.439998626708984,33.7599983215332,33.0,32.47999954223633,32.93000030517578,32.79999923706055,33.0,33.849998474121094,33.7400016784668,34.220001220703125,33.38999938964844,34.0,34.66999816894531,34.2400016784668,34.22999954223633,31.799999237060547,32.459999084472656,32.560001373291016,33.70000076293945,32.4900016784668,31.8700008392334,31.100000381469727,30.829999923706055,30.010000228881836,30.610000610351562,31.760000228881836,31.6200008392334,32.04999923706055,32.41999816894531,32.29999923706055,31.600000381469727,32.29999923706055,32.9900016784668,33.45000076293945,33.0099983215332,32.70000076293945,32.38999938964844,32.36000061035156,34.040000915527344,34.209999084472656,33.95000076293945,33.849998474121094,34.56999969482422,31.270000457763672,30.719999313354492,31.649999618530273,31.799999237060547,30.559999465942383,30.110000610351562,30.059999465942383,30.059999465942383,30.260000228881836,30.280000686645508,29.979999542236328,30.25,32.06999969482422,32.0099983215332,33.060001373291016,32.15999984741211,32.439998626708984,33.56999969482422,33.83000183105469,34.27000045776367,34.61000061035156,34.15999984741211,33.599998474121094,34.16999816894531,34.83000183105469,36.20000076293945,31.600000381469727,32.04999923706055,32.130001068115234,30.600000381469727,29.989999771118164,30.059999465942383,30.020000457763672,29.760000228881836,30.280000686645508,30.299999237060547,30.65999984741211,30.510000228881836,30.06999969482422,29.649999618530273,29.270000457763672,29.600000381469727,29.079999923706055,27.309999465942383,27.6200008392334,27.06999969482422,26.989999771118164,26.489999771118164,26.290000915527344,27.979999542236328,28.329999923706055,28.079999923706055,27.93000030517578,28.530000686645508,29.139999389648438,28.030000686645508,27.670000076293945,28.479999542236328,28.799999237060547,28.65999984741211,28.229999542236328,28.25,27.489999771118164,27.959999084472656,28.600000381469727,29.18000030517578,29.170000076293945,29.020000457763672,29.329999923706055,30.700000762939453,31.010000228881836,31.350000381469727,32.290000915527344,34.150001525878906,33.68000030517578,33.83000183105469,33.849998474121094,34.209999084472656,34.869998931884766,36.630001068115234,37.22999954223633,37.11000061035156,36.25,31.709999084472656,31.719999313354492,32.0099983215332,32.7599983215332,33.41999816894531,31.729999542236328,32.40999984741211,33.439998626708984,33.63999938964844,33.279998779296875,33.63999938964844,34.47999954223633,32.43000030517578,33.22999954223633,33.849998474121094,33.41999816894531,33.34000015258789,32.099998474121094,31.799999237060547,31.790000915527344,31.479999542236328,30.649999618530273,31.1200008392334,31.059999465942383,30.780000686645508,31.270000457763672,31.09000015258789,31.170000076293945,31.940000534057617,29.940000534057617,29.290000915527344,29.670000076293945,29.270000457763672,29.309999465942383,29.799999237060547,32.18000030517578,31.3700008392334,32.54999923706055,33.65999984741211,33.630001068115234,33.25,33.0,33.939998626708984,33.41999816894531,33.38999938964844,34.209999084472656,35.41999816894531,36.470001220703125,37.720001220703125,34.25,33.529998779296875,32.709999084472656,32.959999084472656,32.56999969482422,29.809999465942383,29.860000610351562,29.950000762939453,28.299999237060547,27.149999618530273,27.350000381469727,26.899999618530273,26.1200008392334,26.989999771118164,27.700000762939453,27.149999618530273,27.15999984741211,26.700000762939453,26.780000686645508,23.329999923706055,23.440000534057617,24.25,23.860000610351562,24.360000610351562);

		showRead(useCase);
		// show();

		//System.out.println(useCase.run(showHistory()));
	}

	private static void showRead(IdentifyTrendUseCase useCase) throws IOException {
		InputStream inputStream = new FileInputStream(new File("/home/brevio/py_projs/finances/fileTest.txt"));
		IdentifyTrendIn in = new IdentifyTrendIn();
		String data = readFromInputStream(inputStream);
//		Files.delete(Paths.get("/home/brevio/Downloads/fileTest.txt"));
		RestTemplate restTemplate = new RestTemplate();
		ResponseEntity<List> response =  restTemplate.getForEntity("http://127.0.0.1:5000/history?ticker=BRFS3.SA", List.class);
		
		List<String> historyStr = (List<String>) response.getBody().stream().map(String::valueOf).collect(Collectors.toList());
		
		//List<Double> history = Stream.of(data.split(",")).map(Double::valueOf).collect(Collectors.toList());
		List<Double> history = historyStr.stream().map(Double::valueOf).collect(Collectors.toList());
		
		Collections.reverse(history);
		in.setHistory(history);

		System.out.println(useCase.run(in));

	}

	private static IdentifyTrendIn showHistory() throws IOException {
		Calendar from = Calendar.getInstance();
		Calendar to = Calendar.getInstance();
		from.add(Calendar.YEAR, -5); // from 5 years ago

		Stock google = YahooFinance.get(PAPER, from, to, Interval.DAILY);
		List<HistoricalQuote> history = google.getHistory();
		List<Double> historyDoubles = new ArrayList<Double>();
		history.forEach(d -> {
			try {
				historyDoubles.add(d.getClose().doubleValue());
			} catch (NullPointerException e) {
				historyDoubles.add(0.0);
			}
		});
		Collections.reverse(historyDoubles);
		IdentifyTrendIn in = new IdentifyTrendIn();
		in.setHistory(historyDoubles);
		return in;
		// google.print();
	}

	private static void show() throws IOException {

		Stock stock = YahooFinance.get(PAPER);

		BigDecimal price = stock.getQuote().getPrice();
		BigDecimal change = stock.getQuote().getChangeInPercent();
		BigDecimal peg = stock.getStats().getPeg();
		BigDecimal dividend = stock.getDividend().getAnnualYieldPercent();

		System.out.println(price);
		stock.print();

	}

	private static String readFromInputStream(InputStream inputStream) throws IOException {
		StringBuilder resultStringBuilder = new StringBuilder();
		try (BufferedReader br = new BufferedReader(new InputStreamReader(inputStream))) {
			String line;
			while ((line = br.readLine()) != null) {
				resultStringBuilder.append(line).append(",");
			}
		}
		return resultStringBuilder.toString();
	}

}
